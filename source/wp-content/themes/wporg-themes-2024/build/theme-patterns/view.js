(()=>{"use strict";const e=window.wp.url,t=window.wp.keycodes,s=class{constructor(e,t){this.state=t,this.container=e,this.selected=t.initialSelected>=0?t.initialSelected:null,this.current=null;const s=e.querySelector("button");s&&s.addEventListener("click",this.showAll.bind(this));const i=e.querySelector('[role="listbox"]');i.addEventListener("focus",this.handleFocus.bind(this)),i.addEventListener("keydown",this.handleKeyboard.bind(this)),i.querySelectorAll("li").forEach(((e,t)=>{e.dataset.index=t,e.addEventListener("click",this.handleClick.bind(this))})),this.updateRender()}handleClick(e){const t=e.target.closest("li");t&&(t.closest("ul").focus({preventScroll:!0}),this.current=1*t.dataset.index,this.updateSelected(),this.updateRender())}handleFocus(){this.current=this.current||0,this.updateRender()}increment(e=!1){const t=this.state.hideOverflow?this.state.initialCount:this.state.totalCount;e?this.current=t-1:this.current+1<=t-1&&(this.current+=1)}decrement(e=!1){e?this.current=0:this.current-1>=0&&(this.current-=1)}handleKeyboard(e){if(e.keyCode===t.DOWN||e.keyCode===t.RIGHT)this.increment(e.metaKey);else if(e.keyCode===t.END)this.increment(!0);else if(e.keyCode===t.UP||e.keyCode===t.LEFT)this.decrement(e.metaKey);else if(e.keyCode===t.HOME)this.decrement(!0);else{if(e.keyCode!==t.ENTER&&e.keyCode!==t.SPACE)return;this.updateSelected()}e.preventDefault(),this.updateRender()}showAll(){this.state.hideOverflow=!1,this.updateRender(),this.container.querySelectorAll(".wp-block-wporg-screenshot-preview").forEach((e=>{const t=new Event("wporg-show");e.dispatchEvent(t)})),setTimeout((()=>{const e=this.container.querySelector('[role="listbox"]');e&&e.focus()}),0)}updateSelected(){if(this.current===this.selected){if(!this.state.allowUnselect)return;this.selected=null}else this.selected=this.current;const e=this.container.querySelector('[role="listbox"]'),t=e.querySelectorAll("li");if(t)if(t[this.selected]){const s=new CustomEvent("wporg-select");s.selectedElement=t[this.selected],e.dispatchEvent(s)}else if(t[this.current]){const s=new CustomEvent("wporg-unselect");s.selectedElement=t[this.current],e.dispatchEvent(s)}}updateRender(){const e=this.container.querySelector('[role="listbox"]'),t=e.querySelectorAll("li");void 0!==t[this.current]&&(e.setAttribute("aria-activedescendant",t[this.current].id),t[this.current].scrollIntoView({block:"nearest",inline:"nearest"})),t.forEach(((e,t)=>{t===this.current?e.classList.add("is-focus"):e.classList.remove("is-focus"),t===this.selected?e.setAttribute("aria-selected","true"):e.setAttribute("aria-selected","false"),this.state.hideOverflow&&t>this.state.initialCount-1?e.style.display="none":e.style.display=null}))}};window.addEventListener("load",(()=>{const t=document.querySelectorAll(".wp-block-wporg-theme-patterns");t&&t.forEach((t=>{const i=JSON.parse(t.dataset.initialState);new s(t,i),t.closest(".wp-block-wporg-theme-previewer")||t.querySelector('[role="listbox"]').addEventListener("wporg-select",(t=>{const s=t.selectedElement;if(s&&s.dataset){let t=window.location.toString();t=t.replace(/\/$/,"")+"/preview/",t=(0,e.addQueryArgs)(t,{pattern_name:s.dataset.pattern_name}),window.location=t}}))}))}))})();